= Erstellen einer Updatesite und Ver√∂ffentlichen des Repositories

Um in anderen Repositories mit Klassen der Core-Anwendung arbeiten zu k√∂nnen muss dieses Repo in Targetplatformen aufgenommen werden k√∂nnen. 
Um dies zu erm√∂glichen wird eine Updatesite genutzt. 
F√ºr die Core Anwendung ist diese link:https://github.com/minova-afis/aero.minova.rcp.updatesite[aero.minova.rcp.updatesite].

== Erstellen der Updatesite

Die Updatesite wird als neues Repositorie angelegt.
Unter `Settings -> Pages` kann der `main`-Branch zum Ver√∂ffentlichen ausgew√§hlt werden.
Der Inhalt des Repositories wird nun ver√∂ffentlicht, sobald auf `main` gepushed wird.
Weitere Info in der link:https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site[Doku von Github].

image::images/updatesitePages.png[] 

== (Automatisches) Ver√∂ffentlichen des Repositories

Das RCP-Repository kann automatisch √ºber einen Workflow ver√∂ffentlicht werden. 
Daf√ºr einfach unter `Actions -> Deploy to Updatesite` den Workflow mit einer entsprechenden Commit-Message ansto√üen. 
Das Projekt wird gebaut und auf die Updatesite ausgeliefert.

Alternativ kann auch per Hand eine neue Version auf der Updatesite eingespielt werden.
Daf√ºr wird nach dem Bauen der WFC-Anwendung einfach der Inhalt des Ordners `/aero.minova.rcp/releng/aero.minova.rcp.update/target/repository/` in den root-Ordner des Updatesite-Repositories kopiert.

== Vorraussetzungen f√ºrs automatische Ver√∂ffentlichen

Um die Anwendung automatisch zu deployen muss ein workflow angelegt werden, f√ºr die RCP-Anwendung ist dieser link:https://github.com/minova-afis/aero.minova.rcp/blob/master/.github/workflows/deployToUpdatesite.yml[hier] zu finden.
Das Deployen wird mit folgendem Code angesto√üen:

[source,yml]
----
- name: Deploy üöÄ
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUBACTION_TOKEN_SECRET }}
      run: |
        git config --global user.email "erlanger@minova.com"
        git config --global user.name "CE7"
        echo $GITHUB_TOKEN
        git clone https://CE7:$GITHUB_TOKEN@github.com/minova-afis/aero.minova.rcp.updatesite
        cd aero.minova.rcp.updatesite
        rm -fr * 
        pwd
        cp -r ../releng/aero.minova.rcp.update/target/repository/* .
        git add .
        git commit -m "${{ github.event.inputs.description }}"
        git push -f https://CE7:$GITHUB_TOKEN@github.com/minova-afis/aero.minova.rcp.updatesite HEAD:main
----

Das Updatesite-Repository wird gecloned, der neue Stand wird in den entsprechenden Ornder kopiert und das ganze wird wieder auf die Updatesite gepushed.
*Wichtig ist, dass das Updatesite-Repository √∂ffentlich ist.*

Au√üerdem muss ein Personal Access Token erstellt und dem RCP-Repository hinzugef√ºgt werden.
Das Token wird unter dem eigenen `Profil -> Settings -> Developer Settings -> Personal Access Tokens` erstellt. 
Das Token muss Repository-Berechtigungen haben und sollte kein Ablaufdatum haben.
Der erstellte Wert muss gespeichert werden, da er √ºber Github nach Verlassen der Website nicht mehr einsehbar ist.

Dieses Token wird jetzt im RCP-Repository eingetragen.
Daf√ºr im Repository unter `Settings -> Secrets` (man ben√∂tigt Admin-Rechte im Repository um die Einstellungen zu sehen) den Knopf `New repository secret` klicken, dem Secret einen Namen geben (dieser wird dann im Workflow genutzt) und den geheimen Wert als Value speichern.

image:images/updatesitePAT.png[,450,]
image:images/updatesiteSecret.png[,450,]


== Konfiguration des Core-Projekts

Damit unsere Anwendung Ver√∂ffentlicht werden kann haben wir eine Datei `releng/aero.minova.rcp.update/category.xml`, die unsere Features als Eintr√§ge enth√§lt:

[source,xml]
----
<?xml version="1.0" encoding="UTF-8"?>
<site>
   <feature id="aero.minova.rcp.feature">
      <category name="rcpcore"/>
   </feature>
   <feature id="aero.minova.libs.feature">
      <category name="rcpcore"/>
   </feature>
   <category-def name="rcpcore" label="Core RCP Application"/>
</site>
----

== Einbinden in Target-Platformen

Die Updatesite kann √ºber die URL link:https://minova-afis.github.io/aero.minova.rcp.updatesite/[https://minova-afis.github.io/aero.minova.rcp.updatesite/] 
in eine beliebige Targetplatform eingebunden werden.

image:images/updatesiteTarget.png[]

Tipp: Eclipse cached den Inhalt von Softwareseiten. Sollte eine √Ñnderung an der Updatesite nicht in der Targetplatform auftauchen kann ein Neustart von Eclipse helfen.
